{"version":3,"file":"commonHelpers.js","sources":["../src/js/modal-window.js","../src/js/bestsellers.js","../src/js/categories.js"],"sourcesContent":["import * as basicLightbox from 'basiclightbox';\nimport 'basiclightbox/dist/basicLightbox.min.css';\nimport { getData } from './books-api';\nimport { addToLS, getFromLS } from './local-storage-functions';\nimport { isSignedIn, saveBooksToFB } from './modal-authorization';\nimport { refs } from './refs';\n\nconst { bookIdsLSKey } = refs;\n\nconst localRefs = {};\n// ОСНОВНА ФУНКЦІЯ НА ЕКСПОРТ\nexport async function bookOnClick(e) {\n  // Getting all using data\n  const bookElem = e.target.closest('li');\n  if (!bookElem) {\n    return;\n  }\n  const bookId = bookElem.dataset.bookId;\n  const bookData = await getData(bookId);\n  const book = bookData.data;\n\n  const { book_image: image, title, author, description, buy_links } = book;\n  const [amazon, applebooks] = buy_links;\n\n  const bookMarkup = `\n  <div class=\"modal-window\">\n    <button type=\"button\" class=\"modal-window-close-btn\">\n      <svg class=\"modal-window-close-btn-icon\" width=\"28\" height=\"28\">\n        <use href=\"./img/icons.svg#icon-x-close\"></use>\n      </svg>\n    </button>\n\n    <div class=\"modal-window-book\">\n      <img\n        class=\"modal-window-book-img\"\n        src=\"${image}\"\n        alt=\"\"\n      />\n      <div>\n        <h2 class=\"modal-window-book-title\">${title}</h2>\n        <p class=\"modal-window-book-author\">${author}</p>\n        <p class=\"modal-window-book-description\">\n        ${description}\n        </p>\n        <div class=\"modal-window-book-wheretobuy-links-container\">\n          <a href=\"${amazon.url}\" class=\"amazon-link\" target=\"_blank\">\n            <img src=\"./img/amazon.png\" alt=\"\" />\n          </a>\n          <a\n            href=\"${applebooks.url}\"\n            class=\"applebooks-link\"\n            target=\"_blank\"\n          >\n            <img src=\"./img/applebooks.png\" alt=\"\" />\n          </a>\n        </div>\n      </div>\n    </div>\n    <button type=\"button\" class=\"modal-window-book-shopping-list-button\">\n      Add to shopping list\n    </button>\n    <p class=\"modal-window-congratulations visually-hidden\">\n      Congratulations! You have added the book to the shopping list. To delete,\n      press the button “Remove from the shopping list”.\n    </p>\n  </div>`;\n\n  // Modal Window\n  const instance = basicLightbox.create(bookMarkup, {\n    onShow: instance => {\n      instance.element().querySelector('.modal-window-close-btn').onclick =\n        instance.close;\n      window.addEventListener('keydown', handleKeyDown);\n      document.body.style.overflow = 'hidden';\n    },\n    onClose: () => {\n      window.removeEventListener('keydown', handleKeyDown);\n      document.body.style.overflow = '';\n      const { shopListBtn } = localRefs;\n      shopListBtn.removeEventListener('click', shopListBtnOnClick);\n    },\n  });\n\n  // HELPERS\n\n  instance.show();\n  shopListLogic(bookId);\n  function handleKeyDown(e) {\n    if (e.key === 'Escape') {\n      instance.close();\n    }\n  }\n}\n\nfunction shopListLogic(bookIdValue) {\n  localRefs.shopListBtn = document.querySelector(\n    '.modal-window-book-shopping-list-button'\n  );\n  localRefs.congratulationsText = document.querySelector(\n    '.modal-window-congratulations'\n  );\n\n  const { shopListBtn } = localRefs;\n  checkShopListBtnStatus(bookIdValue);\n  shopListBtn.addEventListener('click', () => {\n    shopListBtnOnClick(bookIdValue);\n  });\n}\n\nfunction shopListBtnOnClick(bookIdValue) {\n  const isBookInLS = checkShopListBtnStatus(bookIdValue);\n  const booksIdArray = getFromLS(bookIdsLSKey) || [];\n  if (isBookInLS) {\n    const bookToRemoveIndex = booksIdArray.indexOf(bookIdValue);\n    booksIdArray.splice(bookToRemoveIndex, 1);\n    addToLS(bookIdsLSKey, booksIdArray);\n    if (isSignedIn) {\n      saveBooksToFB(booksIdArray);\n    }\n\n    checkShopListBtnStatus(bookIdValue);\n  } else {\n    booksIdArray.push(bookIdValue);\n    addToLS(bookIdsLSKey, booksIdArray);\n    if (isSignedIn) {\n      saveBooksToFB(booksIdArray);\n    }\n    checkShopListBtnStatus(bookIdValue);\n  }\n}\n\nfunction checkShopListBtnStatus(bookIdValue) {\n  const { congratulationsText, shopListBtn } = localRefs;\n  const booksIdArray = getFromLS(bookIdsLSKey) || [];\n  const isBookInLS = booksIdArray.includes(bookIdValue);\n  if (!isBookInLS) {\n    shopListBtn.textContent = 'add to shopping list';\n  } else {\n    shopListBtn.textContent = 'remove from the shopping list';\n    congratulationsText.classList.toggle('visually-hidden');\n  }\n\n  return isBookInLS;\n}\n","import { getData } from './books-api';\nimport { showLoader, hideLoader } from './loader.js';\nimport { onCategoryClick } from './categories.js';\nimport {\n  renderCategoriesList,\n  renderTitle,\n  changeCategoryColor,\n} from './categories';\nimport { categoriesList } from './categories.js';\nimport { bookOnClick } from './modal-window';\n\nexport const booksContainer = document.querySelector('.books-container');\nasync function fetchTopBooks() {\n  const response = await getData('top-books');\n  const data = response.data;\n  return data;\n}\n\n// ФУНКЦІЯ ЯКА ВІДМАЛЬОВУЄ БЕСТСЕЛЕРИ\nexport async function renderBestSellersBooks() {\n  showLoader();\n  const booksArray = await fetchTopBooks();\n  const booksContainerMarkup = booksArray\n    .map(topBooks => {\n      const books = topBooks.books;\n      const title = topBooks.list_name;\n      return renderBooksBlock(books, title);\n    })\n    .join('');\n  const title = renderTitle('Best Sellers Books');\n  const markup = title + booksContainerMarkup;\n  booksContainer.innerHTML = markup;\n  changeCategoryColor();\n  hideLoader();\n}\n\n// функція для створення div-у з книгою\nfunction renderBooksBlock(books, title) {\n  const booksListMarkup = books.map(book => templateBook(book)).join('');\n  const bookSectionMarkup = `<div class=\"category-books-wrapper\"><h2 class=\"category-title-bestsellers\">${title}</h2><ul class=\"books-list\">${booksListMarkup}</ul><button type=\"button\" class=\"books-list-btn\"\" data-category-name=\"${title}\">See more</button></div>`;\n  return bookSectionMarkup;\n}\n\n// функція для створення li-шки з книгою\nfunction templateBook({ book_image, title, author, _id: id }) {\n  return `\n      <li class=\"book-item\" data-book-id=\"${id}\">\n        <div class=\"book-image-container\">\n          <img\n            class=\"book-image\"\n            src=\"${book_image}\"\n            alt=\"${title}\"\n          />\n          <div class=\"book-overlay\">QUICK VIEW</div>\n        </div>\n        <h3 class=\"book-title\">${title}</h3>\n        <p class=\"book-author\">${author}</p>\n      </li>\n    `;\n}\n// ВИКЛИКАЄТЬСЯ В МЕЙНІ 1 РАЗ ПРИ ЗАВАНТАЖЕННІ СТОРІНКИ\nexport async function onPageLoad() {\n  await renderCategoriesList();\n  await renderBestSellersBooks();\n  booksContainer.addEventListener('click', onCategoryClick);\n  booksContainer.addEventListener('click', bookOnClick);\n  categoriesList.addEventListener('click', onCategoryClick);\n}\n\nonPageLoad();\n","import { getData } from './books-api';\nimport { renderBestSellersBooks } from './bestsellers';\nimport { booksContainer } from './bestsellers';\nimport { showLoader, hideLoader } from './loader.js';\nexport const categoriesList = document.querySelector('.categories-list');\n\n// Список категорій\nasync function fetchCategoriesList() {\n  const response = await getData('category-list');\n  return response;\n}\n\nexport async function renderCategoriesList() {\n  try {\n    const response = await fetchCategoriesList();\n    if (response.statusText !== 'OK') {\n      throw new Error('Server error');\n    }\n    const booksArray = response.data;\n    const inAlphabeticalOrder = booksArray.sort((a, b) =>\n      a.list_name.localeCompare(b.list_name)\n    );\n\n    const allCategoriesListItem = `<li class=\"categories-list-item\" ><p data-category-name=\"All Categories\">All Categories</p></li>`;\n    const markup = inAlphabeticalOrder\n      .map(\n        category =>\n          `<li class=\"categories-list-item\" >\n<p data-category-name=\"${category.list_name}\">${category.list_name}</p>\n</li>`\n      )\n      .join('');\n\n    categoriesList.innerHTML = allCategoriesListItem + markup;\n  } catch (error) {\n    console.log(error);\n  }\n}\n\n// КНИЖКИ\nexport function renderTitle(categoryName) {\n  const categoryNameSplitted = categoryName.split(' ');\n  const titleLastWord = categoryNameSplitted[categoryNameSplitted.length - 1];\n  const categoryNameWithoutLastWord = categoryNameSplitted\n    .slice(0, -1)\n    .join(' ');\n\n  const pageTitle = `<h1 class=\"books-container-title\">${categoryNameWithoutLastWord}<span class=\"last-word-title\"> ${titleLastWord}</span></h1>`; // Вставити класс замість className // Класи в андріани беремо.\n  return pageTitle;\n}\n\n// Розміткa одного li елементу\nfunction renderBookByCategory(booksArray) {\n  const booksMarkup = booksArray\n    .map(book => {\n      const { book_image: image, title, author, _id: id } = book;\n      return `<li class=\"book-item\" data-book-id=\"${id}\">\n      <div class=\"book-image-container\">\n        <img\n          class=\"book-image\"\n          src=\"${image}\"\n          alt=\"${title}\"\n        />\n        <div class=\"book-overlay\">QUICK VIEW</div>\n      </div>\n      <h3 class=\"book-title\">${title}</h3>\n      <p class=\"book-author\">${author}</p>\n    </li>`;\n    })\n    .join('');\n  const markup = `<ul class=\"books-by-category-list\">${booksMarkup}</ul>`;\n  return markup;\n}\n\n// Це основна функція рендеру книжок за категорією. Імпортується до Андріани та вішається як колбек на слухач подій на кнопки See More\nasync function renderCategoryBooks(categoryName) {\n  showLoader();\n  const response = await getData('category', categoryName);\n  const booksArray = response.data;\n  const booksTitle = renderTitle(categoryName);\n  const books = renderBookByCategory(booksArray);\n  const allCategoriesButtonMarkup = `<button class=\"books-list-btn all-categories-btn\" type=\"button\" data-category-name=\"All Categories\">All Categories</button>`;\n  const markup = booksTitle + books + allCategoriesButtonMarkup;\n  booksContainer.innerHTML = markup;\n  hideLoader();\n  changeCategoryColor();\n}\n\n// Слухач подій\nexport async function onCategoryClick(event) {\n  const categoryName = event.target.dataset.categoryName;\n  if (categoryName === 'All Categories') {\n    booksContainer.innerHTML = '';\n    renderBestSellersBooks();\n    return;\n  } else if (categoryName) {\n    renderCategoryBooks(categoryName);\n  }\n  return;\n}\n\nexport function changeCategoryColor() {\n  const h1Text = document.querySelector('.books-container-title').textContent;\n  const lis = document.querySelectorAll(\n    '.categories-list > .categories-list-item > p'\n  );\n  lis.forEach(li => li.classList.remove('current-category'));\n\n  lis.forEach(li => {\n    const liText = li.textContent.trim();\n    const allCategoriesLi = 'All Categories';\n    const allCategoriesTitle = 'Best Sellers Books';\n    if (h1Text === allCategoriesTitle && liText === allCategoriesLi) {\n      li.classList.add('current-category');\n      return;\n    }\n  });\n  lis.forEach(li => {\n    const liText = li.textContent.trim();\n\n    if (h1Text === liText) {\n      li.classList.add('current-category');\n      return;\n    }\n  });\n}\n\nvar swiper = new Swiper('.mySwiper', {\n  direction: 'vertical',\n  slidesPerView: 'auto',\n  freeMode: true,\n  scrollbar: {\n    el: '.swiper-scrollbar',\n  },\n  mousewheel: true,\n});\n"],"names":["bookIdsLSKey","refs","localRefs","bookOnClick","e","bookElem","bookId","book","getData","image","title","author","description","buy_links","amazon","applebooks","bookMarkup","instance","basicLightbox.create","handleKeyDown","shopListBtn","shopListBtnOnClick","shopListLogic","bookIdValue","checkShopListBtnStatus","isBookInLS","booksIdArray","getFromLS","bookToRemoveIndex","addToLS","isSignedIn","saveBooksToFB","congratulationsText","booksContainer","fetchTopBooks","renderBestSellersBooks","showLoader","booksContainerMarkup","topBooks","books","renderBooksBlock","markup","renderTitle","changeCategoryColor","hideLoader","booksListMarkup","templateBook","book_image","id","onPageLoad","renderCategoriesList","onCategoryClick","categoriesList","fetchCategoriesList","response","inAlphabeticalOrder","b","allCategoriesListItem","category","error","categoryName","categoryNameSplitted","titleLastWord","renderBookByCategory","booksArray","renderCategoryBooks","booksTitle","allCategoriesButtonMarkup","event","h1Text","lis","li","liText"],"mappings":"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"}