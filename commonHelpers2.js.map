{"version":3,"file":"commonHelpers2.js","sources":["../src/js/pagination.js","../src/js/shop-list.js"],"sourcesContent":["import tuiPagination from 'tui-pagination';\nimport { getFromLS } from './local-storage-functions';\nimport { refs } from './refs';\n\nconst { bookIdsLSKey } = refs;\nfunction getTotalBooks() {\n  const myArray = getFromLS(bookIdsLSKey) || [];\n  return myArray.length;\n}\nconst paginationContainer = document.getElementById('pagination');\nexport function initPagination() {\n  const listItems = document.querySelector(\n    '.shopping-list-gallery-books'\n  ).children;\n\n  const itemsPerPage = window.innerWidth < 768 ? 4 : 3;\n  const visiblePages = window.innerWidth < 768 ? 2 : 3;\n\n  const totalItems = getTotalBooks();\n\n  const pagination = new tui.Pagination(paginationContainer, {\n    totalItems,\n    itemsPerPage,\n    visiblePages,\n    centerAlign: true,\n  });\n\n  function handlePageChange(event) {\n    //перевірка чи треба показувати панель пагінації\n    if (totalItems <= 3) {\n      paginationContainer.classList.add('hidden');\n      return;\n    } else {\n      paginationContainer.classList.remove('hidden');\n    }\n\n    //поточна сторінка\n    const currentPage = event.page - 1;\n    // Приховати всі елементи\n    for (let i = 0; i < listItems.length; i++) {\n      listItems[i].style.display = 'none';\n    }\n\n    // Показати елементи для поточної сторінки\n    for (\n      let i = currentPage * itemsPerPage;\n      i < (currentPage + 1) * itemsPerPage;\n      i++\n    ) {\n      if (listItems[i]) {\n        listItems[i].style.display = 'block';\n      }\n    }\n  }\n\n  //  обробник подій для зміни сторінки\n  pagination.on('afterMove', handlePageChange);\n\n  // Ініціалізація сторінки за замовчуванням\n  handlePageChange({ page: 1 });\n}\n","import { getData } from './books-api';\nimport { addToLS, getFromLS } from './local-storage-functions';\nimport { isSignedIn, saveBooksToFB } from './modal-authorization';\nimport { showLoader, hideLoader } from './loader.js';\nimport { refs } from './refs';\nimport { initPagination } from './pagination';\nimport icons from '../img/icons.svg';\nimport amazonIcon from '../img/amazon.png';\nimport appleIcon from '../img/applebooks.png';\nimport { iziToastMessage } from './izi-toast.js';\n\nconst { bookIdsLSKey } = refs;\n\n// Fonction pour récupérer les données des livres\nasync function fetchBookData() {\n  const booksIds = getFromLS(bookIdsLSKey);\n  try {\n    const array = booksIds.map(bookId => getData(bookId));\n    const results = await Promise.allSettled(array);\n    const fulfilledResults = results.filter(\n      promise => promise.status === 'fulfilled'\n    );\n    const booksArray = fulfilledResults.map(result => result.value.data);\n\n    return booksArray;\n  } catch (error) {\n    console.error('Error fetching book data:', error);\n    return [];\n  }\n}\n\n// Fonction pour afficher les livres\nasync function renderBooks() {\n  const shoppingList = document.querySelector('.shopping-list-gallery-books');\n  try {\n    const booksArray = await fetchBookData();\n\n    const booksMarkup = booksArray\n      .map(book => {\n        const {\n          book_image: image,\n          title,\n          author,\n          description,\n          _id: id,\n          buy_links,\n        } = book;\n        const [amazon, applebooks] = buy_links;\n        return `<li class=\"shopping-list-books-items\">\n                <div class=\"shopping-list-books-information\">\n                  <div class=\"shopping-list-basket-img\">\n                    <img class=\"shopping-list-img\" src=\"${image}\"/>\n                  </div>\n                  <div class=\"shopping-list-text-content\">\n                    <h2 class=\"shopping-list-books-title\">${title}</h2>\n                    <button data-book-id=\"${id}\" type=\"button\" class=\"shopping-list-button\">\n                      <svg class=\"shopping-list-delete\">\n                        <use href=\"${icons}#icon-trash\"></use>\n                      </svg>\n                    </button>\n                    <h3 class=\"shopping-list-books-category\">Category</h3>\n                    <p class=\"shopping-list-books-desc\">${description}</p>\n                    <p class=\"shopping-list-author\">${author}</p>\n                    <ul class=\"shopping-list-shop-list\">\n                      <li class=\"shopping-list-shop-list-items\">\n                        <a class=\"shopping-list-shop-list-link\" target=\"_blank\" href=\"${amazon.url}\">\n                          <img class=\"shopping-list-link-amazon\" src=\"${amazonIcon}\" alt=\"logo-amazon\">\n                        </a>\n                      </li>\n                      <li class=\"shopping-list-shop-list-items\">\n                        <a class=\"shopping-list-shop-list-link\" target=\"_blank\" href=\"${applebooks.url}\">\n                          <img class=\"shopping-list-link-apple\" src=\"${appleIcon}\" alt=\"apple-books\">\n                        </a>\n                      </li>\n                    </ul>\n                  </div>\n                </div>\n              </li>`;\n      })\n      .join('');\n    shoppingList.innerHTML = booksMarkup;\n  } catch (error) {\n    console.error('Error rendering books:', error);\n  }\n}\n\n// Fonction pour supprimer un livre\nfunction bookOnDelete(e) {\n  const deleteButton = e.target.closest('button');\n  if (deleteButton) {\n    const id = deleteButton.dataset.bookId;\n    const booksIdArray = getFromLS(bookIdsLSKey);\n    const bookToRemoveIndex = booksIdArray.indexOf(id);\n    booksIdArray.splice(bookToRemoveIndex, 1);\n    addToLS(bookIdsLSKey, booksIdArray);\n    if (isSignedIn) {\n      saveBooksToFB(booksIdArray);\n    }\n    loadShopingList();\n  }\n}\n\nconst shoppingListGallery = document.querySelector(\n  '.shopping-list-gallery-books'\n);\nconst shoppingListEmptyState = document.querySelector(\n  '.shopping-list-empty-state'\n);\n\nconst shoppingListSection = document.querySelector('.shopping-list-wrapper');\nshoppingListSection.addEventListener('click', bookOnDelete);\n\n// Fonction à exécuter lors du chargement de la page pour les 2 états de la page\nexport async function loadShopingList() {\n  const booksIdArray = getFromLS(bookIdsLSKey) || [];\n  if (booksIdArray.length > 0) {\n    await renderBooks();\n    initPagination();\n    shoppingListEmptyState.style.display = 'none';\n  } else {\n    shoppingListGallery.style.display = 'none';\n    shoppingListEmptyState.style.display = 'block';\n  }\n}\n\nasync function initShopingList() {\n  try {\n    showLoader();\n    await loadShopingList();\n    hideLoader();\n    initPagination();\n  } catch (error) {\n    console.error(error);\n    iziToastMessage(false, 'Server Error');\n  }\n}\n\ninitShopingList();\n"],"names":["bookIdsLSKey","refs","getTotalBooks","getFromLS","paginationContainer","initPagination","listItems","itemsPerPage","visiblePages","totalItems","pagination","handlePageChange","event","currentPage","i","fetchBookData","booksIds","array","bookId","getData","promise","result","error","renderBooks","shoppingList","booksMarkup","book","image","title","author","description","id","buy_links","amazon","applebooks","icons","amazonIcon","appleIcon","bookOnDelete","e","deleteButton","booksIdArray","bookToRemoveIndex","addToLS","isSignedIn","saveBooksToFB","loadShopingList","shoppingListGallery","shoppingListEmptyState","shoppingListSection","initShopingList","showLoader","hideLoader","iziToastMessage"],"mappings":"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"}