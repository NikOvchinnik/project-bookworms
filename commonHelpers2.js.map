{"version":3,"file":"commonHelpers2.js","sources":["../src/js/shop-list.js"],"sourcesContent":["import { getData } from './books-api';\nimport { addToLS, getFromLS } from './local-storage-functions';\nimport { isSignedIn, saveBooksToFB } from './modal-authorization';\nimport { showLoader, hideLoader } from './loader.js';\nimport { refs } from './refs';\n\nconst { bookIdsLSKey } = refs;\n\n// Fonction pour récupérer les données des livres\nasync function fetchBookData() {\n  const booksIds = getFromLS(bookIdsLSKey);\n  try {\n    const array = booksIds.map(bookId => getData(bookId));\n    const results = await Promise.allSettled(array);\n    const fulfilledResults = results.filter(\n      promise => promise.status === 'fulfilled'\n    );\n    const booksArray = fulfilledResults.map(result => result.value.data);\n\n    return booksArray;\n  } catch (error) {\n    console.error('Error fetching book data:', error);\n    return [];\n  }\n}\n\n// Fonction pour afficher les livres\nasync function renderBooks() {\n  const shoppingList = document.querySelector('.shopping-list-gallery-books');\n  try {\n    const booksArray = await fetchBookData();\n\n    const booksMarkup = booksArray\n      .map(book => {\n        const {\n          book_image: image,\n          title,\n          author,\n          description,\n          _id: id,\n          buy_links,\n        } = book;\n        const [amazon, applebooks] = buy_links;\n        return `<li class=\"shopping-list-books-items\">\n                <div class=\"shopping-list-books-information\">\n                  <div class=\"shopping-list-basket-img\">\n                    <img class=\"shopping-list-img\" src=\"${image}\"/>\n                  </div>\n                  <div class=\"shopping-list-text-content\">\n                    <h2 class=\"shopping-list-books-title\">${title}</h2>\n                    <button data-book-id=\"${id}\" type=\"button\" class=\"shopping-list-button\">\n                      <svg class=\"shopping-list-delete\" >\n                        <use href=\"../img/icons.svg#icon-trash\"></use>\n                      </svg>\n                    </button>\n                    <h3 class=\"shopping-list-books-category\">Category</h3>\n                    <p class=\"shopping-list-books-desc\">${description}</p>\n                    <p class=\"shopping-list-author\">${author}</p>\n                    <ul class=\"shopping-list-shop-list\">\n                      <li class=\"shopping-list-shop-list-items\">\n                        <a class=\"shopping-list-shop-list-link\" target=\"_blank\" href=\"${amazon.url}\">\n                          <img class=\"shopping-list-link-amazon\" src=\"../img/amazon.png\" alt=\"logo-amazon\">\n                        </a>\n                      </li>\n                      <li class=\"shopping-list-shop-list-items\">\n                        <a class=\"shopping-list-shop-list-link\" target=\"_blank\" href=\"${applebooks.url}\">\n                          <img class=\"shopping-list-link-apple\" src=\"../img/applebooks.png\" alt=\"apple-books\">\n                        </a>\n                      </li>\n                    </ul>\n                  </div>\n                </div>\n              </li>`;\n      })\n      .join('');\n    hideLoader();\n    shoppingList.innerHTML = booksMarkup;\n  } catch (error) {\n    console.error('Error rendering books:', error);\n  }\n}\n\n// Fonction pour supprimer un livre\nfunction bookOnDelete(e) {\n  e.preventDefault();\n  const deleteButton = e.target.closest('button');\n  if (deleteButton) {\n    const id = deleteButton.dataset.bookId;\n    const booksIdArray = getFromLS(bookIdsLSKey);\n    const bookToRemoveIndex = booksIdArray.indexOf(id);\n    booksIdArray.splice(bookToRemoveIndex, 1);\n    addToLS(bookIdsLSKey, booksIdArray);\n    if (isSignedIn) {\n      saveBooksToFB(booksIdArray);\n    }\n    loadShopingList();\n    return;\n  }\n  const parentElement = e.target.parentNode;\n  // Vérifie si l'élément parent est un lien\n  if (parentElement.tagName === 'A') {\n    // Si oui, récupère l'URL du lien\n    const url = parentElement.getAttribute('href');\n    // Ouvre l'URL dans une nouvelle fenêtre\n    window.open(url, '_blank');\n    return;\n  }\n  return;\n}\n\nconst shoppingListGallery = document.querySelector(\n  '.shopping-list-gallery-books'\n);\nconst shoppingListEmptyState = document.querySelector(\n  '.shopping-list-empty-state'\n);\n\nconst shoppingListSection = document.querySelector('.shopping-list-section');\nshoppingListSection.addEventListener('click', bookOnDelete);\n\n// Fonction à exécuter lors du chargement de la page pour les 2 états de la page\nexport function loadShopingList() {\n  showLoader();\n  const booksIdArray = getFromLS(bookIdsLSKey) || [];\n  if (booksIdArray.length > 0) {\n    renderBooks();\n    // shoppingListGallery.style.display = 'block';\n    shoppingListEmptyState.style.display = 'none';\n  } else {\n    hideLoader();\n    shoppingListGallery.style.display = 'none';\n    shoppingListEmptyState.style.display = 'block';\n  }\n}\n\nloadShopingList();\n"],"names":["bookIdsLSKey","refs","fetchBookData","booksIds","getFromLS","array","bookId","getData","promise","result","error","renderBooks","shoppingList","booksMarkup","book","image","title","author","description","id","buy_links","amazon","applebooks","hideLoader","bookOnDelete","e","deleteButton","booksIdArray","bookToRemoveIndex","addToLS","isSignedIn","saveBooksToFB","loadShopingList","parentElement","url","shoppingListGallery","shoppingListEmptyState","shoppingListSection","showLoader"],"mappings":"mIAMA,KAAM,CAAE,aAAAA,CAAc,EAAGC,EAGzB,eAAeC,GAAgB,CAC7B,MAAMC,EAAWC,EAAUJ,CAAY,EACvC,GAAI,CACF,MAAMK,EAAQF,EAAS,IAAIG,GAAUC,EAAQD,CAAM,CAAC,EAOpD,OANgB,MAAM,QAAQ,WAAWD,CAAK,GACb,OAC/BG,GAAWA,EAAQ,SAAW,WACpC,EACwC,IAAIC,GAAUA,EAAO,MAAM,IAAI,CAGpE,OAAQC,EAAO,CACd,eAAQ,MAAM,4BAA6BA,CAAK,EACzC,EACR,CACH,CAGA,eAAeC,GAAc,CAC3B,MAAMC,EAAe,SAAS,cAAc,8BAA8B,EAC1E,GAAI,CAGF,MAAMC,GAFa,MAAMX,KAGtB,IAAIY,GAAQ,CACX,KAAM,CACJ,WAAYC,EACZ,MAAAC,EACA,OAAAC,EACA,YAAAC,EACA,IAAKC,EACL,UAAAC,CACD,EAAGN,EACE,CAACO,EAAQC,CAAU,EAAIF,EAC7B,MAAO;AAAA;AAAA;AAAA,0DAG2CL,CAAK;AAAA;AAAA;AAAA,4DAGHC,CAAK;AAAA,4CACrBG,CAAE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,0DAMYD,CAAW;AAAA,sDACfD,CAAM;AAAA;AAAA;AAAA,wFAG4BI,EAAO,GAAG;AAAA;AAAA;AAAA;AAAA;AAAA,wFAKVC,EAAW,GAAG;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,oBAQtG,CAAO,EACA,KAAK,EAAE,EACVC,IACAX,EAAa,UAAYC,CAC1B,OAAQH,EAAO,CACd,QAAQ,MAAM,yBAA0BA,CAAK,CAC9C,CACH,CAGA,SAASc,EAAaC,EAAG,CACvBA,EAAE,eAAc,EAChB,MAAMC,EAAeD,EAAE,OAAO,QAAQ,QAAQ,EAC9C,GAAIC,EAAc,CAChB,MAAMP,EAAKO,EAAa,QAAQ,OAC1BC,EAAevB,EAAUJ,CAAY,EACrC4B,EAAoBD,EAAa,QAAQR,CAAE,EACjDQ,EAAa,OAAOC,EAAmB,CAAC,EACxCC,EAAQ7B,EAAc2B,CAAY,EAC9BG,GACFC,EAAcJ,CAAY,EAE5BK,IACA,MACD,CACD,MAAMC,EAAgBR,EAAE,OAAO,WAE/B,GAAIQ,EAAc,UAAY,IAAK,CAEjC,MAAMC,EAAMD,EAAc,aAAa,MAAM,EAE7C,OAAO,KAAKC,EAAK,QAAQ,EACzB,MACD,CAEH,CAEA,MAAMC,EAAsB,SAAS,cACnC,8BACF,EACMC,EAAyB,SAAS,cACtC,4BACF,EAEMC,EAAsB,SAAS,cAAc,wBAAwB,EAC3EA,EAAoB,iBAAiB,QAASb,CAAY,EAGnD,SAASQ,GAAkB,CAChCM,KACqBlC,EAAUJ,CAAY,GAAK,CAAA,GAC/B,OAAS,GACxBW,IAEAyB,EAAuB,MAAM,QAAU,SAEvCb,IACAY,EAAoB,MAAM,QAAU,OACpCC,EAAuB,MAAM,QAAU,QAE3C,CAEAJ,EAAiB"}